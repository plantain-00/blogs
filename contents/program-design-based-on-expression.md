# 基于表达式的程序设计

对于某些业务，例如：

1. 复杂查询，例如 JIRA 任务的 filter
2. “规则”相关的需求，例如定义类似 cron 的定时任务
3. “关联”相关的需求，例如设置一段文字的颜色总是等于另一段文字的颜色

如果按照普通定义数据模型的方式，当业务越来越复杂，定义的数据模型、数据传输结构、数据库结构、GUI 等都需要随之进行扩展。

而如果使用表达式作为业务的内部存储、实现方式，数据模型、数据传输结构、数据库结构里就只是表达式字符串，不再需要频繁扩展，执行查询、规则的代码也不再需要频繁修改，需要修改的只是 GUI，从而大幅提高开发、维护效率。

例如：

1. 条件表达式，`name = 'foo' AND status = 'SUCCESS'`
2. 行为表达式，例如设置 text2 的文字颜色属性为 `text1.color`

设置表达式时，可以：

1. 对表达式进行 parse，根据 parse 出的数据，显示对应的输入 GUI
2. 提供高级模式，或自定义模式，以供用户可以直接输入表达式

对于“关联”相关的需求，使用表达式也可以更容易分析各个“关联”之间的依赖关系，例如，下面是不使用表达式的内置关联关系：

```ts
get width() {
    return this.parent.width - this.marginLeft - this.marginRight
}
```

而如果使用表达式，这种内置关联关系可以表示为：

```ts
width = 'this.parent.width - this.marginLeft - this.marginRight'
```

如果用户设置 marginLeft 属性为 `this.width`，就和上述内置关联冲突了，width 和 marginLeft 相互依赖。

在对用户设置的关联关系、内置关联关系进行依赖分析时，表达式形式的内置关联关系，可以通过 parse 出的 AST 进行分析，和对用户设置的关联关系分析方式一致；而 getter 代码形式的内置关联关系，就无法提供这些数据，只能额外的代码检查来进行分析，随着内置关联关系越来越复杂，额外的代码检查也需要保持相应的更新，从而增加了维护成本。
